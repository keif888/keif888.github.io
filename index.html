<html>
    <body>
    <div>
        <input id="testinput" type="file"  multiple>
        <div>
          <button id="addbtn" class="btn">Add Text</button>
          <p>Files Selected</p>
          <p id="droparea">
          </p>
        </div>
      </div>
    </body>
    <script>
let htmlOutput = "";
let iteration = 0;
const inputhandler = document.getElementById("testinput");

document.getElementById("addbtn").addEventListener('click', function () {
  htmlOutput += "test entry<br>";
  let htmldata = `${htmlOutput}`;
  document.getElementById("droparea").innerHTML = htmldata;
});

inputhandler.addEventListener("change", function (e) {
  const files = e.target.files;
  totalSize = 0;
  selected = files;
  // Calculate total upload size.
  for (let i = 0; i < selected.length; i++) {
    let file = selected[i];
    totalSize += file.size;
  }
  
  htmlOutput += `Total File Size ${totalSize}<br>`;
  let htmldata = `${htmlOutput}`;
  document.getElementById("droparea").innerHTML = htmldata;
  
  async function performUpload(ctx) {
    for (let i = 0; i < ctx.length; i++) {
          let file = ctx[i];
          let formData = new FormData();
          formData.append("files", file);
          fetch("https://www.postb.in/1739016317362-5863291204441", {  // This will need to be changed frequently.
              method: "post",
              mode : "no-cors",
              headers: {
                  "Content-Type": "multipart/form-data"
              },
              body: formData,
            });
          htmlOutput += `Iteration ${iteration} call api file upload for ${file.name} with size ${file.size}<br>`;
          let htmldata = `${htmlOutput}`;
          document.getElementById("droparea").innerHTML = htmldata;
    }
  }
  
  performUpload(selected).then(() => {
          htmlOutput += `Iteration ${iteration} call api album create<br>`;
          let htmldata = `${htmlOutput}`;
          document.getElementById("droparea").innerHTML = htmldata;
  })
  iteration++;
});
    </script>
</html>
